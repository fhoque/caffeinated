(function(){function a(){var c=$(".worldmap-container"),d=c.find("canvas");width=d.width()/100,height=d.height()/100;c.find(".worldmap-marker").each(function(){var e=$(this).data("person");$(this).css({left:width*e.x-$(this).width()/2,top:height*e.y-$(this).height()-5})})}function b(){worldmap.drawing.draw(new Date(),$(".worldmap-day")[0],$(".worldmap-night")[0],$(".worldmap-output")[0]);a()}window.worldmap={updateMarkers:a,init:function(d){var c=$(".worldmap-container"),e=c.parent();$(".worldmap-container").click(function(){c.toggleClass("worldmap-fullscreen");if(c.is(".worldmap-fullscreen")){c.appendTo(document.body)}else{c.appendTo(e)}a()}).disableSelection();if(d.draggable){$(".worldmap-marker").addClass("worldmap-marker-draggable").draggable({containment:"parent",start:function(f,g){$(this).tooltip("disable").tooltip("widget").hide()},stop:function(j,k){$(this).tooltip("enable");var h=$(this).parent().find("canvas"),i=h.width()/100,f=h.height()/100;var g=$(this).data("person");g.x=(k.position.left+$(this).width()/2)/i;g.y=(k.position.top+$(this).height()+5)/f;d.dragged(g)}})}b();setInterval(function(){b();d.redraw&&d.redraw()},1000*60)}}}());worldmap.astronomy={degToRadians:function(a){return a*Math.PI/180},radiansToDegs:function(a){return a*180/Math.PI},springEquinox:{2007:{day:21,h:0,m:7},2008:{day:20,h:5,m:48},2009:{day:20,h:11,m:44},2010:{day:20,h:17,m:32},2011:{day:20,h:23,m:21},2012:{day:20,h:5,m:14},2013:{day:20,h:11,m:2},2014:{day:20,h:16,m:57},2015:{day:20,h:22,m:45},2016:{day:20,h:4,m:30},2017:{day:20,h:10,m:28},2018:{day:20,h:16,m:15},2019:{day:20,h:21,m:58},2020:{day:20,h:3,m:49}},fallEquinox:{2007:{day:23,h:9,m:51},2008:{day:22,h:15,m:44},2009:{day:22,h:21,m:18},2010:{day:23,h:3,m:9},2011:{day:23,h:9,m:4},2012:{day:22,h:14,m:49},2013:{day:22,h:20,m:44},2014:{day:23,h:2,m:29},2015:{day:23,h:8,m:20},2016:{day:22,h:14,m:21},2017:{day:22,h:20,m:2},2018:{day:23,h:1,m:54},2019:{day:23,h:7,m:50},2020:{day:22,h:13,m:30}},sunriseTime:function(c,b,a){return this.time(c,b,a,"sunrise")},sunsetTime:function(c,b,a){return this.time(c,b,a,"sunset")},time:function(m,c,p,k){var l=m/15;var e=k=="sunrise"?6:18;var s=(e-l)/24+p;var n=0.9856*s-3.289;var r=n+(1.916*Math.sin(this.degToRadians(n)))+(0.02*Math.sin(this.degToRadians(2*n)))+282.634;if(r<0){r+=360}else{if(r>=360){r-=360}}var f=this.radiansToDegs(Math.atan(0.91764*Math.tan(this.degToRadians(r))));var g=Math.floor(r/90)*90;var i=Math.floor(f/90)*90;f+=g-i;f/=15;var j=0.39782*Math.sin(this.degToRadians(r));var o=Math.cos(Math.asin(j));var d=(-0.01454-(j*Math.sin(this.degToRadians(c))))/(o*Math.cos(this.degToRadians(c)));if(d>1||d<-1){return 0}var q;if(k=="sunrise"){q=360-this.radiansToDegs(Math.acos(d))}else{q=this.radiansToDegs(Math.acos(d))}q/=15;var b=q+f-(0.06571*s)-6.622;var a=b-l;if(a<0){a+=24}else{if(a>=24){a-=24}}return a},dayOfYear:function(e,f,a){var d=Math.floor(275*f/9);var c=Math.floor((f+9)/12);var b=1+Math.floor((e-4*Math.floor(e/4)+2)/3);return d-(c*b)+a-30}};(function(d){d.drawing={createCanvas:function(i,g){var h=document.createElement("canvas");h.width=i;h.height=g;return h},draw:function(j,l,h,i){var g=800,n=400;var q=this.createCanvas(g,n);maskCtx=q.getContext("2d");this.drawMask(maskCtx,j);e(q,0,0,g,n,30);var m=maskCtx.getImageData(0,0,g,n);var p=b(l,q,g,n);var k=this.createCanvas(g,n);k.getContext("2d").putImageData(p,0,0);var o=i.getContext("2d");o.clearRect(0,0,o.canvas.width,o.canvas.height);o.drawImage(h,0,0,g,n);o.drawImage(k,0,0,g,n)},drawMask:function(w,j){var k=j.getUTCFullYear();var i=d.astronomy.springEquinox[k];var o=d.astronomy.dayOfYear(k,3,i.day)+(i.h+(i.m/60))/24;var g=d.astronomy.fallEquinox[k];var h=d.astronomy.dayOfYear(k,9,g.day)+(g.h+(g.m/60))/24;var p=j.getUTCHours()+(j.getUTCMinutes()/60)+(j.getUTCSeconds()/3600);var m=d.astronomy.dayOfYear(k,j.getUTCMonth()+1,j.getUTCDate());var r=m+p/24;var u=(r>o&&r<h);var y=u?0:180;var z=10;var s=w.canvas.width/360,l=w.canvas.height/180;for(var q=-180;q<=180;q=q+z){for(var t=90;t>=-90;t=t-z){var n=d.astronomy.sunriseTime(q,t,m);var x=d.astronomy.sunsetTime(q,t,m);var v=false;if(x===0||n===0){x=0;n=0}if(x===0&&n===0){if(t<0){if(!u){v=true}}else{if(u){v=true}}}else{if(x<n){if((p>n&&p<x+24)||((p+24)>n&&((p+24)<(x+24)))){v=true}}else{if(p>n&&p<x){v=true}}}if(false&&q==130){console.log("latitude: "+t+" - sunriseTime :"+n+" - sunsetTime: "+x+" - currentUTC:"+p+" - "+(v?" DAY":"NIGHT"))}if(v){w.fillRect((180+q)*s,(90+-t)*l,s*z,l*z)}}}}};function b(m,u,j,t,r){if(!document.createElement("canvas").getContext){return m}var h=document.createElement("canvas"),n=h.getContext("2d"),s=document.createElement("canvas"),k=s.getContext("2d"),l=null,g=null,p=null;h.width=j;h.height=t*2;s.width=j;s.height=t;n.drawImage(m,0,0);n.drawImage(u,0,t);l=n.getImageData(0,0,j,t);g=l.data;p=n.getImageData(0,t,j,t).data;for(var o=3,q=g.length;o<q;o=o+4){g[o]=p[o]}if(r){k.clearRect(0,0,j,t);k.putImageData(l,0,0);return s.toDataURL()}else{return l}}var a=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259];var f=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function e(o,L,J,g,j,U){if(isNaN(U)||U<1){return}U|=0;var ad=o.getContext("2d");var Z=ad.getImageData(L,J,g,j);var n=Z.data;var S,R,ab,Y,z,C,t,l,m,I,X,w,K,G,h,O,T,A,v,s,B,D,E,N;var ac=U+U+1;var P=g<<2;var u=g-1;var W=j-1;var r=U+1;var V=r*(r+1)/2;var M=new c();var H=M;for(ab=1;ab<ac;ab++){H=H.next=new c();if(ab==r){var q=H}}H.next=M;var aa=null;var Q=null;t=C=0;var F=a[U];var k=f[U];for(R=0;R<j;R++){O=T=A=v=l=m=I=X=0;w=r*(s=n[C]);K=r*(B=n[C+1]);G=r*(D=n[C+2]);h=r*(E=n[C+3]);l+=V*s;m+=V*B;I+=V*D;X+=V*E;H=M;for(ab=0;ab<r;ab++){H.r=s;H.g=B;H.b=D;H.a=E;H=H.next}for(ab=1;ab<r;ab++){Y=C+((u<ab?u:ab)<<2);l+=(H.r=(s=n[Y]))*(N=r-ab);m+=(H.g=(B=n[Y+1]))*N;I+=(H.b=(D=n[Y+2]))*N;X+=(H.a=(E=n[Y+3]))*N;O+=s;T+=B;A+=D;v+=E;H=H.next}aa=M;Q=q;for(S=0;S<g;S++){n[C+3]=E=(X*F)>>k;if(E!=0){E=255/E;n[C]=((l*F)>>k)*E;n[C+1]=((m*F)>>k)*E;n[C+2]=((I*F)>>k)*E}else{n[C]=n[C+1]=n[C+2]=0}l-=w;m-=K;I-=G;X-=h;w-=aa.r;K-=aa.g;G-=aa.b;h-=aa.a;Y=(t+((Y=S+U+1)<u?Y:u))<<2;O+=(aa.r=n[Y]);T+=(aa.g=n[Y+1]);A+=(aa.b=n[Y+2]);v+=(aa.a=n[Y+3]);l+=O;m+=T;I+=A;X+=v;aa=aa.next;w+=(s=Q.r);K+=(B=Q.g);G+=(D=Q.b);h+=(E=Q.a);O-=s;T-=B;A-=D;v-=E;Q=Q.next;C+=4}t+=g}for(S=0;S<g;S++){T=A=v=O=m=I=X=l=0;C=S<<2;w=r*(s=n[C]);K=r*(B=n[C+1]);G=r*(D=n[C+2]);h=r*(E=n[C+3]);l+=V*s;m+=V*B;I+=V*D;X+=V*E;H=M;for(ab=0;ab<r;ab++){H.r=s;H.g=B;H.b=D;H.a=E;H=H.next}z=g;for(ab=1;ab<=U;ab++){C=(z+S)<<2;l+=(H.r=(s=n[C]))*(N=r-ab);m+=(H.g=(B=n[C+1]))*N;I+=(H.b=(D=n[C+2]))*N;X+=(H.a=(E=n[C+3]))*N;O+=s;T+=B;A+=D;v+=E;H=H.next;if(ab<W){z+=g}}C=S;aa=M;Q=q;for(R=0;R<j;R++){Y=C<<2;n[Y+3]=E=(X*F)>>k;if(E>0){E=255/E;n[Y]=((l*F)>>k)*E;n[Y+1]=((m*F)>>k)*E;n[Y+2]=((I*F)>>k)*E}else{n[Y]=n[Y+1]=n[Y+2]=0}l-=w;m-=K;I-=G;X-=h;w-=aa.r;K-=aa.g;G-=aa.b;h-=aa.a;Y=(S+(((Y=R+r)<W?Y:W)*g))<<2;l+=(O+=(aa.r=n[Y]));m+=(T+=(aa.g=n[Y+1]));I+=(A+=(aa.b=n[Y+2]));X+=(v+=(aa.a=n[Y+3]));aa=aa.next;w+=(s=Q.r);K+=(B=Q.g);G+=(D=Q.b);h+=(E=Q.a);O-=s;T-=B;A-=D;v-=E;Q=Q.next;C+=g}}ad.putImageData(Z,L,J)}function c(){this.r=0;this.g=0;this.b=0;this.a=0;this.next=null}})(worldmap);window.worldmap||(window.worldmap={});worldmap.time=function(g){var j=1000*60*60;var d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var b=new Date();var l=b.getTime()+b.getTimezoneOffset()*j/60;var k=new Date();k.setTime(l+j*g.offset);var f=k.getHours();function a(n){var m=/pm/.test(n);return parseInt(n)+(m?12:0)}var i=a(g.workingBegin);var h=a(g.workingEnd);var c="offline";if(f>=i&&f<h){c="online"}else{if(f>=h&&f<h+1){c="away"}else{if(f>=i-1&&f<i){c="away"}}}var e=d[k.getDay()]+", "+k.getHours()+":";if(k.getMinutes()<10){e+="0"+k.getMinutes()}else{e+=k.getMinutes()}return{available:c,time:e}};